/*
 * This file is part of the UCB release of Plan 9. It is subject to the license
 * terms in the LICENSE file found in the top-level directory of this
 * distribution and at http://akaros.cs.berkeley.edu/files/Plan9License. No
 * part of the UCB release of Plan 9, including this file, may be copied,
 * modified, propagated, or distributed except according to the terms contained
 * in the LICENSE file.
 */

#include "u.h"
#include "lib.h"
#include "dat.h"
#include "fns.h"
#include "error.h"

int32_t
sysexits(uint32_t *arg)
{
	char *status;
	char *inval = "invalid exit string";
	char buf[ERRMAX];

	status = (char *)arg[0];
	if(status) {
		if(waserror())
			status = inval;
		else {
			validaddr((uint32_t)status, 1, 0);
			if(vmemchr(status, 0, ERRMAX) == 0) {
				memmove(buf, status, ERRMAX);
				buf[ERRMAX - 1] = 0;
				status = buf;
			}
		}
		poperror();
	}
	pexit(status, 1);
	return 0; /* not reached */
}
