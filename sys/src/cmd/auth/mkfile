</$objtype/mkfile
#
#		programs
#
TARG=\
	authsrv\
	changeuser\
	convkeys\
	convkeys2\
	cron\
	debug\
	guard.srv\
	iam\
	keyfs\
	login\
	netkey\
	passwd\
	printnetkey\
	uniq\
	warning\
	wrkey\

DIRS=lib\
	factotum\
	secstore\

OTHEROFILES=\
	challenge.$O\
	convbio.$O\
	respond.$O\
	secureidcheck.$O\
	userpasswd.$O\

HFILES=/sys/include/auth.h /sys/include/authsrv.h authcmdlib.h

LIB=lib.$O.a /$objtype/lib/libc.a
BIN=/$objtype/bin/auth
CLIB=`{ls lib/*.c}

UPDATE=\
	mkfile\
	$HFILES\
	${OTHEROFILES:%.$O=%.c}\
	${TARG:%=%.c}\
	${TARG:%=/386/bin/auth/%}\

</sys/src/cmd/mkmany

all:V:	$DIRS

$DIRS:V:
	for (i in $DIRS) @{
		echo mk $i
		cd $i
		mk all
	}

lib.$O.a:V:
	cd lib
	mk

all:V:	$DIRS

$DIRS:V:
	for (i in $DIRS) @{
		echo mk $i
		cd $i
		mk all
	}

install:V:	installdirs $BIN/status $BIN/enable $BIN/disable

installdirs:V:
	for (i in $DIRS) @{
		echo mk $i
		cd $i
		mk install
	}

cleandirs:V:
	for (i in $DIRS) @{
		echo clean $i
		cd $i
		mk clean
	}

nukedirs:V:
	for (i in $DIRS) @{
		echo nuke $i
		cd $i
		mk nuke
	}

update:V:
	update $UPDATEFLAGS $UPDATE
	for (i in $DIRS) @{
		echo update $i
		cd $i
		mk 'UPDATEFLAGS='$"UPDATEFLAGS update
	}

clean:V:
	mk cleandirs
	rm -f *.[$OS] *.[$OS].a [$OS].* y.tab.? y.debug y.output $TARG

nuke:V:
	mk nukedirs
	rm -f *.[$OS] *.[$OS].a [$OS].* y.tab.? y.debug y.output $TARG *.acid

$O.authsrv: lib.$O.a authsrv.$O secureidcheck.$O
	$LD -o $O.authsrv $prereq

$O.guard.srv: lib.$O.a guard.srv.$O secureidcheck.$O
	$LD -o $O.guard.srv $prereq

$BIN/netkey:V:	$O.netkey
	cp $O.netkey /$objtype/bin/netkey

$BIN/passwd:V:	$O.passwd
	cp $O.passwd /$objtype/bin/passwd

$BIN/status:V:
	cp status $target

$BIN/enable:V:
	cp enable $target

$BIN/disable:V:
	cp disable $target
