From ulysses!grass Mon Feb 24 13:00:02 EST 1992
To: research!andrew
Subject: avg-jeg.c


#include <stdio.h>

/* vadim's tables
static char cvtab[] = {
	0xee, 0xa0, 0xa1, 0xe6, 0xa4, 0xa5, 0xe4, 0xa3,
	0xe5, 0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae,
	0xaf, 0xef, 0xe0, 0xe1, 0xe2, 0xe3, 0xa6, 0xa2,
	0xec, 0xeb, 0xa7, 0xe8, 0xed, 0xe9, 0xe7, 0xea,
	0x9e, 0x80, 0x81, 0x96, 0x84, 0x85, 0x94, 0x83,
	0x95, 0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e,
	0x8f, 0x9f, 0x90, 0x91, 0x92, 0x93, 0x86, 0x82,
	0x9c, 0x9b, 0x87, 0x98, 0x9d, 0x99, 0x97, 0x9a
};
*/

static char cvtab[] = {
	0xee, 0xd0, 0xd1, 0xe1, 0xd4, 0xd5, 0xe4, 0xd3,
	/* ju, a, b, c, d, e, f, g, */
	0xe5, 0xd8, 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xde,
    /* h, i, ik, k, l, m, n, o */
	0xdf, 0xef, 0xe0, 0xe1, 0xe2, 0xe3, 0xd6, 0xd2,
	/* p, ja, r, s, t, u, zh, v */
	0xec, 0xeb, 0xd7, 0xe9, 0xed, 0xe8, 0xe7, 0xea,
	/* mz, y, z, sh, eh, shch, ch, tz */
	0xce, 0xb0, 0xb1, 0xc6, 0xb4, 0xb5, 0xc4, 0xb3,
	/* Ju, A, B, C, D, E, F, G, */
	0xc5, 0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe,
    /* H, I, Ik, K, L, M, N, O */
	0xbf, 0xcf, 0xc0, 0xc1, 0xc2, 0xc3, 0xb6, 0xb2,
	/* P, Ja, R, S, T, U, Zh, V */
	0xcc, 0xcb, 0xb7, 0xc9, 0xcd, 0xc8, 0xc7, 0xca
	/* Mz,Y, Z, Sh, Eh, Shch, Ch, Tz */
};


int nl2cr;

main(ac, av)
char **av;
{
	int i;

	if( ac > 1 ) {
		if( av[1][0] == '-' ) {
			if( av[1][1] == 'm' )
				 nl2cr++;
			else if( av[1][1] != '-' ) {
				fputs("Usage: k8-alt [-m] [file...]\n", stderr)
;
				exit(1);
			}
			ac--, av++;
		}
	}
	if( ac == 1 )
		cvt(stdin);
	else {
		for( i = 1 ; i < ac ; i++ ) {
			FILE *iff;

			if( (iff = fopen(av[i], "r")) == NULL ) {
				fputs("k8-alt: cannot open file ", stderr);
				fputs(av[i], stderr);
				putc('\n', stderr);
				exit(1);
			}
			cvt(iff);
			fclose(iff);
		}
	}
	exit(0);
}

cvt(f)
	register FILE *f;
{
	register c;

	while( (c = getc(f)) != EOF ) {
		if( (c & 0300) == 0300 )
			c = cvtab[c-0300];
		else if( c == '\n' && nl2cr )
			putchar('\r');
		putchar(c);
	}
}

