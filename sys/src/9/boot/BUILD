load("//sys/src/harvey.BUILD","LIB_COMPILER_FLAGS","harvey_binary")

data_to_c(
    name="amd64cpu",
    bin="bin/bootamd64cpu",
    prefix="ramfs_bootamd64cpu_",
    deps=[
        ":bootamd64cpu"
    ]
)

cc_library(
    name="libboot",
    copts=LIB_COMPILER_FLAGS,
    includes=[
        "//sys/include",
        "//sys/src/9/boot",
        "//amd64/include",
    ],
    deps=[
        ":bootamd64cpuc",
    ],
    srcs=[
        "aux.c",
        "bootauth.c",
        "boot.c",
        "bootcache.c",
        "bootip.c",
        "bootamd64cpu.c",
        "bootrc.c",
        "embed.c",
        "local.c",
        "paq.c",
        "sac.c",
        "settime.c"
    ]
)

harvey_binary(
    name="bootamd64cpu",
    includes=[
        "//sys/include",
        "//sys/src/9/boot",
        "//amd64/include",
    ],
    srcs=[
        "printstub.c",
        "bootamd64cpu.c"
    ],
    deps=[
        ":libboot",
        ":bootamd64cpuc",
        "//sys/src/libip:libip",
        "//sys/src/libauth:libauth",
        "//sys/src/libc:libc"
    ],
)

mk_sys(
    name="bootamd64cpuc",
    mode="bootamd64cpu.c",
    arch="amd64",
    sysconf="//sys/src/sysconf.json",
)
