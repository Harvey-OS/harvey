.TH PLAN9.INI 8
.SH NAME
plan9.ini \- configuration file for PCs
.SH SYNOPSIS
.I none
.SH DESCRIPTION
When booting Plan 9 on a PC, the DOS program
.IR 9load (8)
first reads a DOS file
containing configuration information from the boot disk.
This file,
.BR plan9.ini ,
looks like a shell script containing lines of the form
.PP
.EX
	name=\f2value\fP
.EE
.LP
each of which defines a kernel or device parameter.
.PP
For devices, the generic format of
.I value
is
.PP
.EX
	type=TYPE [port=N] [irq=N] [mem=N] [size=N] [dma=N] [ea=N]
.EE
.LP
specifying the controller type,
the base I/O port of the interface, its interrupt
level, the physical starting address of any mapped memory,
the length in bytes of that memory, the DMA channel,
and for Ethernets an override of the physical network address.
Not all elements are relevant to all devices; the relevant values
and their defaults are defined below in the description of each device.
.PP
The file is used by
.B 9load
and the kernel to configure the hardware available.
The information it contains is also passed to the boot
process, and subsequently other programs,
as environment variables
(see
.IR boot (8)).
However, values whose names begin with an asterisk
.B *
are used by the kernel and are not converted into environment variables.
.PP
The following sections describe how variables are used.
.SS \fLetherX=value\fP
This defines an Ethernet interface.
.IR X ,
a unique monotonically increasing number beginning at 0,
identifies an Ethernet card to be probed at system boot.
Probing stops when a card is found or there is no line for
.BR etherX+1 .
.PP
Some cards are software configurable and do not require all options.
Unspecified options default to the factory defaults.
.PP
Known types are
.TP
.B ne2000
Not software configurable. 16-bit card.
Defaults are
.EX
	port=0x300 irq=2 mem=0x04000 size=0x4000
.EE
The option (no value)
.B nodummyrr
is needed on some (near) clones to turn off a dummy remote read in the driver.
.TP
.B amd79c970
The AMD PCnet PCI Ethernet Adapter (AM79C970).
Completely configurable, no options need be given.
.TP
.B wd8003
Includes WD8013 and SMC Elite and Elite Ultra cards. There are varying degrees
of software configurability. Cards may be in either 8-bit or 16-bit slots.
Defaults are
.EX
	port=0x280 irq=3 mem=0xD0000 size=0x2000
.EE
BUG: On many machines only the 16 bit card works.
.TP
.B elnk3
The 3COM Etherlink ||| series of cards including the 5x9, 59x, and 905 and 905B.
Completely configurable, no options need be given.
The media may be specified by setting
.B media=
to the value
.BR 10BaseT ,
.BR 10Base2 ,
.BR 100BaseTX ,
.BR 100BaseFX ,
.BR aui ,
and
.BR mii .
If you need to force full duplex, because for example the Ethernet switch does not negotiate correctly,
just name the word (no value)
.B fullduplex
or
.BR 100BASE-TXFD .
Similarly, to force 100Mbit operation, specify
.BR force100 .
Port 0x110 is used for the little ISA configuration dance.
.TP
.B 3c589
The 3COM 3C589 series PCMCIA cards.
There is no support for the modem on the 3C562.
Completely configurable, no options need be given.
Defaults are
.EX
	port=0x240 irq=10
.EE
The media may be specified as
.B media=10BaseT
or
.BR media=10Base2 .
.TP
.B ec2t
The Linksys Combo PCMCIA EthernetCard (EC2T),
EtherFast 10/100 (PCMPC100) PCMCIA cards,
the Netgear FA410TX 10/100 PCMCIA card
and the Accton EtherPair-PCMCIA (EN2216).
Completely configurable, no options need be given.
Defaults are
.EX
	port=0x300 irq=9
.EE
These cards are NE2000 clones.
Other NE2000 compatible PCMCIA cards may be tried
with the option
.EX
	id=string
.EE
where
.B string
is a unique identifier string contained in the attribute
memory of the card (see
.IR pcmcia (8));
unlike most options in 
.BR plan9.ini ,
this string is case-sensitive.
The option
.B dummyrr=[01]
can be used to turn off (0) or on (1) a dummy remote read in the driver
in such cases,
depending on how NE2000 compatible they are.
.TP
.B i82557
Cards using the Intel 8255[789] Fast Ethernet PCI Bus LAN Controller such as the
Intel EtherExpress PRO/100B.
Completely configurable, no options need be given.
If you need to force the media, specify
one of the options (no value)
.BR 10BASE-T ,
.BR 10BASE-2 ,
.BR 10BASE-5 ,
.BR 100BASE-TX ,
.BR 10BASE-TFD ,
.BR 100BASE-TXFD ,
.BR 100BASE-T4 ,
.BR 100BASE-FX ,
or
.BR 100BASE-FXFD .
.TP
.B 21114x
Cards using the Digital Equipment (now Intel) 2114x PCI Fast Ethernet Adapter Controller.
Completely configurable, no options need be given.
Media can be specified the same was as for the
.BR i82557 .
Some cards using the
.B PNIC
and
.B PNIC2
near-clone chips may also work.
.PP
.SS \fLscsiX=value\fP
This defines a SCSI interface which cannot be automatically detected
by the kernel.
.PP
Known types are
.TP
.B aha1542
The Adaptec 154x series of controllers (and clones).
Almost completely configurable, only the
.EX
	port=0x300
.EE
option need be given.
.PP
.SS \fLserialX=value\fP
This defines add on serial ports and cards.
Multiple cards can share the same IRQ.  Unfortunately,
many PC's allow only the built in UARTs on the
COM1 and COM2 IRQ's (3 & 4) so beware.
.PP
Known types are
.TP
.B mp008
The TTC 8 serial line card.
The
.B mem
parameter is the port number of the interrupt polling port.
.B Size
is the number of UARTs, default 8.
.B Port
is the port number of the first UART.
.TP
.B "a100i a200i a16i AvanstarXp
The Star Gate Avanstar series of intelligent serial boards.
.TP
.B generic
Any set of 16450 compatible serial lines with consecutive
port addresses.
.B Size
is the number of UARTs, default 1.
.B Port
is the port number of the first UART.
.SS \fLeiaX=disabled\fP
By default,
.B eia0
is initialized as port 0x3F8, IRQ 4 (DOS's COM1)
and 
.B eia1
as port 0x2F8, IRQ 3 (DOS's COM2).
Such a line disables this default initialization,
usually in order to reuse the IRQ for 
another device.
.SS \fLmouseport=value\fP
This specifies where the mouse is attached.
.I Value
can be
.TP
.B ps2
the PS2 mouse/keyboard port.  The BIOS setup procedure
should be used to configure the machine appropriately.
.TP
.B ps2intellimouse
an Intellimouse on the PS2 port.
.TP
.B 0
for COM1
.TP
.B 1
for COM2
.SS \fLmodemport=value\fP
Picks the UART line to call out on.
This is used when connecting to a file server over
an async line.
.I Value
is the number of the port.
.SS \fLpcmciaX=type=XXX irq=value\fP
If the default IRQ for the
PCMCIA
is correct, this entry can be omitted.  The value of
.B type
is ignored.
.SS \fLconsole=value\fP
.SS \fLbaud=value\fP
These are used to specify the console device.
The default 
.I console
value is
.IR cga .
Values of
.I 0
or
.I 1
specify
.I COM1
or 
.I COM2
respectively, in which case
.I baud
is used to initialize the port.
.SS \fLbootfile=value\fP
This is used to direct the actions of
.IR 9load (8)
by naming the device and file from which to load the kernel.
.SS \fLrootdir=dir\fP
.SS \fLrootspec=spec\fP
These are used by
.IR 9load (8)
to identify the directory
.I dir
to make the root directory for the kernel, and the
and file system specifier
.I spec
(see
.B mount
in
.IR bind (2))
on which it can be found.
These are usually used to test variant file systems for distributions, etc.
.SS \fLbootargs=value\fP
The value of this variable is passed to
.IR boot (8)
by the kernel as the name of the root file system.
For example, if the system is to run from a local
.IR kfs (4)
partition, the definition might read
.BR bootargs=local!#S/sdC0/fs .
.SS \fLcfs=value\fP
This gives the name of the file holding the disk partition
for the cache file system,
.IR cfs (4).
Extending the
.B bootargs
example, one would write
.BR cfs=#S/sdC0/cache .
.SS \fLbootdisk=value\fP
This deprecated variable was used to specify the disk used by
the cache file system and other disk-resident services.
It is superseded by
.B bootargs
and
.BR cfs .
.SS \fLpartition=value\fP
This defines the partition table
.IR 9load (8)
will examine to find disk partitioning information.
By default, a partition table in a Plan 9 partition
is consulted; if no such table is found, an old-Plan 9
partition table on the next-to-last or last sector
of the disk is consulted.
A value of 
.B new
consults only the first table,
.B old
only the second.
.SS \fL*maxmem=value\fP
This defines the maximum physical address that the system will scan when sizing memory.
By default the operating system will scan up to 768 megabytes, but setting
.B *maxmem
will limit the scan.
If the system has more than 768 megabytes, you must set
.B *maxmem
for the kernel to find it.
.B *maxmem
must be less than 1.75 gigabytes.
.SS \fL*kernelpercent=value\fP
This defines what percentage of available memory is reserved for the kernel allocation pool.
The remainder is left for user processes.  The default
.I value
is
.BR 30 .
This deprecated option is rarely necessary in newer kernels.
.SS \fL*nomp=value\fP
A multiprocessor machine will enable all processors by default.
Setting
.B *nomp
restricts the kernel to starting only one processor and using the
traditional interrupt controller.
.SS \fL*pcimaxbno=value\fP
This puts a limit on the maximum bus number probed
on a PCI bus (default 255).
For example, a
.I value
of 1 should suffice on a 'standard' motherboard with an AGP slot.
This, and 
.B *pcimaxdno
below are rarely used and only on troublesome or suspect hardware.
.SS \fL*pcimaxdno=value\fP
This puts a limit on the maximum device number probed
on a PCI bus (default 31).
.SS \fLmonitor=value\fP
.SS \fLvgasize=value\fP
These are used not by the kernel but by
.IR vga (8).
.SS \fLnvr=value\fP
This is used by a file server kernel to locate a file holding information
to configure the file system.
The file cannot live on a SCSI disk.
The default is
.B fd!0!plan9.nvr
(sic),
unless
.B bootfile
is set, in which case it is
.B plan9.nvr
on the same disk as
.BR bootfile .
The syntax is either
.BI fd! unit ! name
or
.BI hd! unit ! name
where
.I unit
is the numeric unit id.
This variant syntax is a vestige of the file server kernel's origins.
.SS \fLaudioX=value\fP
This defines a sound interface.
.PP
Known types are
.TP
.B sb16
Sound Blaster 16.
.B ess1688
A Sound Blaster clone.
.PP
The DMA channel may be any of 5, 6, or 7.
The defaults are
.EX
	port=0x220 irq=7 dma=5
.EE
.SS \fLfs=a.b.c.d\fP
.SS \fLauth=a.b.c.d\fP
These specify the IP address of the file and authentication server
to use when mounting a network-provided root file system.
They are used only if the addresses cannot be determined via DHCP.
.SH EXAMPLES
.PP
A representative
.BR plan9.ini :
.IP
.EX
% cat /n/c:/plan9.ini
ether0=type=3C509
mouseport=ps2
modemport=1
serial0=type=generic port=0x3E8 irq=5
monitor=445x
vgasize=1600x1200x8
%

.EE
.PP
Minimum CONFIG.SYS and AUTOEXEC.BAT files to use
COM2 as a console:
.IP
.EX

% cat /n/c:/config.sys
SHELL=COMMAND.COM COM2 /P
% cat /n/c:/autoexec.bat
@ECHO OFF
PROMPT $p$g
PATH C:\eDOS;C:\eBIN
mode com2:96,n,8,1,p
SET TEMP=C:\eTMP
% 

.EE
.SH "SEE ALSO"
.IR 9load (8),
.IR booting (8),
.IR boot (8)
.SH BUGS
Being able to set the console device to other than a
display is marginally useful on file servers; MS-DOS
and the programs which run under it are so tightly bound
to the display that it is necessary to have a display if any
setup or reconfiguration programs need to be run.
Also, the delay before any messages appear at boot time
is disconcerting, as any error messages from the BIOS
are lost.
.PP
This idea is at best an interesting experiment that needs another iteration.
